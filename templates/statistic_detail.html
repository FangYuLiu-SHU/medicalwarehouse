<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/html">
 <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1"
    />
    <title>test</title>
    <link rel="stylesheet" href="../static/layui/css/layui.css" />
    <link rel="stylesheet" href="../static/css/style.css" />
    <style>
      /*.layui-form-label{*/
      /*  width: 90px;*/
      /*  font-size: 14px;*/
      /*}*/
      .layui-input{
        min-height: 20px;
        margin-bottom: 20px;
      }
      .layui-select{
        height: 35px;width: 50px;
      }
      .layui-input-block{
          width: 350px;
      }
      .layui-form-item{
          width: 100%;
          margin-top: 10px;
      }
      .layui-container{
          width: 50%; height: 50%;float: left;
      }

    </style>
  </head>
<body>
  <div class="layui-body" style="left: 0">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
          <legend>输入相关统计指标</legend>
        </fieldset>
            <div id="container2"  style="width:35% ;float: left">
<!--                -->
<!--            <div class="layui-form-item" >-->
<!--            <label class="layui-form-label">科室选择</label>-->
<!--                <div class="layui-input-block" >-->
<!--                  <select name="symptoms_type" lay-filter="info_display_sym"  class="layui-select" >-->
<!--                      <option value="" style="font-size: 14px;">请选择</option>-->
<!--                      <option value="1" style="font-size: 14px;">肾</option>-->
<!--                      <option value="2" style="font-size: 14px;">肺</option>-->
<!--                      <option value="3" style="font-size: 14px;">脾</option>-->
<!--                      <option value="4" style="font-size: 14px;">闻</option>-->
<!--                  </select>-->
<!--                <button class="layui-btn submit_query" lay-submit lay-filter="*0">提交</button>-->
<!--                </div>-->
<!--            </div>-->
                <form class="layui-form" action="" method="post" lay-filter="info_display">
            <div class="layui-form-item" >
            <label class="layui-form-label">症状选择</label>
                <div class="layui-input-block" >
                  <select name="symptoms_type" lay-filter="info_display_sym"  class="layui-select" >
                      <option value="" style="font-size: 14px;">请选择</option>
                      <option value="1" style="font-size: 14px;">肾阳虚</option>
                      <option value="2" style="font-size: 14px;">肾阴虚</option>
                  </select>
<!--                <button class="layui-btn submit_query" lay-submit lay-filter="bt1">提交</button>-->
                </div>
            </div>
           <div class="layui-form-item">
              <label class="layui-form-label">患者性别</label>
              <div class="layui-input-block">
                <select name="gender" lay-filter="info_display_gender"  class="layui-select" >
                  <option value="" selected>请选择</option>
                  <option value="1">男</option>
                  <option value="2">女</option>
                </select>
<!--                <button class="layui-btn submit_query" lay-submit lay-filter="bt2">提交</button>-->
              </div>
            </div>
            <div class="layui-form-item">
                <div class="layui-inline"><label class="layui-form-label">年龄范围</label>
                    <div class="layui-input-inline"style="width: 160px;" >
                        <input type="text" name="min_age" placeholder="最小值" autocomplete="off" class="layui-input">
                    </div>
                    <div class="layui-form-mid">-</div>
                    <div class="layui-input-inline" style="width: 165px;">
                        <input type="text" name="max_age" placeholder="最大值" autocomplete="off" class="layui-input">
                    </div>
                </div>
            </div>
                 <div class="layui-form-item">
                <button class="layui-btn submit_query" lay-submit lay-filter="*" id="LAY-button-shen" style="margin-left: 110px;width: 100px">立即提交</button>
<!--                     <button type="reset" class="layui-btn layui-btn-primary">重置</button>-->
            </div>
                </form>
          </div>

      <div id="container3" style="width:65%;height: 90%;float: left" >
          <div class="layui-container" id="symptoms_fig" ></div>
          <div class="layui-container" id="gender_fig" ></div>
          <div class="layui-container" id="eGFR_fig" ></div>
          <div class="layui-container" id="sc_fig"  ></div>
        </div>
  </div>
   <script src="../static/layui/layui.js"></script>
    <script src="../static/js/jquery.js"></script>
        <script type="text/javascript" src="../static/js/echarts.js"></script>
      <script type="text/javascript" src="../static/js/function.js"></script>
    <script>

    layui.use(['form'], function() {
        var form = layui.form, layer = layui.layer;

        //监听提交
        form.on('submit(*)', function () {
            var data = form.val('info_display');
            var objectData = JSON.parse(JSON.stringify(data));//转成JSON对象
            return objectData
        });
    });
        var newData = {{data_json | tojson}};//获取后端返回的结果
        var returndata = JSON.parse(newData);
        // console.log(returndata)
        // var sc_bins=[]
        // for(var j=0;j<returndata.sc_distribute.bins.length;j++){
        //     if(j===returndata.sc_distribute.bins.length-1){
        //         sc_bins.push(returndata.sc_distribute.bins[j]+"~")
        //     }else {
        //         sc_bins.push((returndata.sc_distribute.bins[j]) + "~" + returndata.sc_distribute.bins[j+1])
        //     }
        //
        // }
        // var eGFR_bins=[]
        // for(var k=0;k<returndata.eGFR_distribute.bins.length;k++){
        //     if(k===returndata.eGFR_distribute.bins.length-1){
        //         eGFR_bins.push(returndata.eGFR_distribute.bins[k]+"~")
        //     }else {
        //         eGFR_bins.push((returndata.eGFR_distribute.bins[k]) + "~" +(returndata.eGFR_distribute.bins[k+1]))
        //     }
        //
        // }
     //
     //    console.log(returndata.eGFR_distribute.bins)
     // console.log(returndata.eGFR_distribute.num)

        var eGFR_data=[],sc_data=[];
        for(var i=0;i<returndata.eGFR_distribute.num.length;i++){
            eGFR_data.push([returndata.eGFR_distribute.bins[i]+10,returndata.eGFR_distribute.num[i]])
        }
        for(var j=0;j<returndata.sc_distribute.num.length;j++){
            sc_data.push([returndata.sc_distribute.bins[j]+50,returndata.sc_distribute.num[j]])
        }
        var yMax = 150;
        console.log(returndata.sc_distribute)
        var dataShadow = [];
        var eGFR_dom = document.getElementById('eGFR_fig');
        var eGFR_chart = echarts.init(eGFR_dom);
        var min_eGFR=90,max_eGFR=120;
        var eGFR_option= {
                title: {
              text: 'eGFR值分布',
              left: 'center'
          },
            tooltip: {
            trigger: 'item',
        },

            xAxis: {
                name:"范围",
                nameGap:20,
                axisLabel: {
                    inside: false,
                    rotate:30,
                },
                axisTick: {
                    show: false,
                    alignWithLabel: true
                },
                axisLine: {
                    show: false
                },
                splitLine:{show:false},
                boundaryGap: true,

            },
            yAxis: {
                name:"人数",
                nameGap:10,
                axisLine: {
                    show: false
                },
                axisTick: {
                    show: false
                },
                axisLabel: {
                    textStyle: {
                        color: '#999'
                    }
                }
            },
            dataZoom: [
                {
                    type: 'inside'
                }
            ],
            series: [
                {
                	name: 'eGFR分布',
                    type: 'bar',
                    itemStyle: {
                        color: new echarts.graphic.LinearGradient(
                            0, 0, 0, 1,
                            [
                                {offset: 0, color: '#828787'},
                                {offset: 0.5, color: '#474a4a'},
                                {offset: 1, color: '#191a1a'}
                            ]
                        )
                    },
                    emphasis: {
                        itemStyle: {
                            color: new echarts.graphic.LinearGradient(
                                0, 0, 0, 1,
                                [
                                    {offset: 0, color: '#14edf0'},
                                    {offset: 0.7, color: '#13a8c2'},
                                    {offset: 1, color: '#017a92'}
                                ]
                            )
                        }
                    },
                    data:eGFR_data,
                    markLine:{
                	    slient:true,
                        // symbol:'none',
                        itemStyle: {
                        normal: {
                            lineStyle:{
                                width:2,
                                type:'dotted'  //'dotted'虚线 'solid'实线
                            },
                            show: true,
                            color: '#f00404',
                            }
                        },
                        label:{
                	        show:false,

                        },
                        data: [{name:"最低阈值", xAxis:90},{name:"最高阈值",xAxis:120}]
                    },
                }
            ]

        };
        eGFR_chart.setOption(eGFR_option);
        var sc_dom = document.getElementById('sc_fig');
        var sc_chart = echarts.init(sc_dom);
        var sc_option= {
                title: {
              text: '血肌酐值分布',
              left: 'center'
          },
             tooltip: {
            trigger: 'item',

        },
            xAxis: {
                name:"范围",
                nameGap:20,
                axisLabel: {
                    inside: false,
                    textStyle: {
                        color: '#120d0d',
                        rotate: 20
                    },
                },
                axisTick: {
                    show: false
                },
                axisLine: {
                    show: false
                },
                splitLine:{show:false},
                boundaryGap: true,
            },
            yAxis: {
                name:"人数",
                nameGap:10,
                axisLine: {
                    show: false
                },
                axisTick: {
                    show: false
                },
                axisLabel: {
                    textStyle: {
                        color: '#999'
                    }
                }
            },
            dataZoom: [
                {
                    type: 'inside'
                }
            ],
            series: [
                {
                    name:'血肌酐分布',

                    type: 'bar',
                    itemStyle: {
                        color: new echarts.graphic.LinearGradient(
                            0, 0, 0, 1,
                            [
                                {offset: 0, color: '#828787'},
                                {offset: 0.5, color: '#474a4a'},
                                {offset: 1, color: '#191a1a'}
                            ]
                        )
                    },
                    emphasis: {
                        itemStyle: {
                            color: new echarts.graphic.LinearGradient(
                                0, 0, 0, 1,
                                [
                                    {offset: 0, color: '#14edf0'},
                                    {offset: 0.7, color: '#13a8c2'},
                                    {offset: 1, color: '#017a92'}
                                ]
                            )
                        }
                    },
                    data: sc_data,
                    markLine:{
                	    slient:true,
                        // symbol:'none',
                        itemStyle: {
                        normal: {
                            lineStyle:{
                                width:2,
                                type:'dotted'  //'dotted'虚线 'solid'实线
                            },
                            show: true,
                            color: '#f00404',
                            }
                        },
                        label:{
                	        show:false,

                        },
                        data: [{name:"最低阈值", xAxis:44},{name:"最高阈值",xAxis:133}]
                    },
                }
            ]

        };
        sc_chart.setOption(sc_option);
        var sex_dom = document.getElementById('gender_fig');
        var sex_chart = echarts.init(sex_dom);
        var sex_option={
          title: {
              text: '患者性别分布',
              left: 'center'
          },
          tooltip: {
              trigger: 'item'
          },
          legend: {
              orient: 'vertical',
              left: 'left',
          },
          series: [
              {
                  // name: '访问来源',
                  type: 'pie',
                  radius: '60%',
                 label: {
                      normal: {
                          position:"inner",
                          show:false,
                      }
                  },
                  data: [
                      {value: returndata.num_male, name: '男性',itemStyle: {color:'#81888e'}},
                      {value:returndata.num_female, name: '女性',itemStyle: {color:'#24abcd'}},
                  ],
                  emphasis: {
                      itemStyle: {
                          shadowBlur: 10,
                          shadowOffsetX: 0,
                          shadowColor: 'rgba(0,0,0,0.5)'
                      }
                  }
              }
          ]
        };
        sex_chart.setOption(sex_option)

        var symptom_dom = document.getElementById('symptoms_fig');
        var symptom_chart = echarts.init(symptom_dom);
        var symptom_option={
          title: {
              text: '患者症状分布',
              left: 'center'
          },
          tooltip: {
              trigger: 'item'
          },
          legend: {
              orient: 'vertical',
              left: 'left',
          },
          series: [
              {
                  type: 'pie',
                  radius: '60%',
                  // label:{
                  //     normal:{
                  //         position:"inner",
                  //         formatter: '{b}:{c}'
                  //     }
                  // },

                  label: {
                      normal: {
                          position:"inner",
                          show:false,
                      }
                  },

                  data: [
                      {value: returndata.num_pos, name: '肾阳虚',itemStyle: {color:'#81888e'}},
                      {value: returndata.num_neg, name: '肾阴虚',itemStyle: {color:'#24abcd'}},
                  ],
                      // .filter(function (e){
                      // let num_pos=e.num_pos,num_neg=e.num_neg;
                      // if(num_pos==0){
                      //     return {value: num_neg, name: '肾阴虚',itemStyle: {color:'#24abcd'}}
                      // }
                      // else if(num_neg==0) {
                      //     return {value: returndata.num_pos, name: '肾阳虚', itemStyle: {color: '#81888e'}}
                      // }
                      // else {
                      //     return {value: returndata.num_pos, name: '肾阳虚',itemStyle: {color:'#81888e'}}, {value: returndata.num_neg, name: '肾阴虚',itemStyle: {color:'#24abcd'}}
                      // }
                  // }),
                  emphasis: {
                      itemStyle: {
                          shadowBlur: 10,
                          shadowOffsetX: 0,
                          shadowColor: 'rgba(0,0,0,0.5)'
                      }
                  }
              }
          ]
        };
        symptom_chart.setOption(symptom_option);
    //     window.addEventListener('resize',function (){
    //         symptom_chart.resize();
    //         sex_chart.resize();
    //         eGFR_chart.resize();
    //         sc_chart.resize();
    // });
    </script>

</body>
</html>